import React, { useState, useEffect } from 'react';
import { Users, Package, Activity, RefreshCw, AlertCircle, Clock, TrendingUp, Database, FileSpreadsheet, CheckCircle } from 'lucide-react';

const FreestoreMonitor = () => {
  const [activeTab, setActiveTab] = useState('customers');
  const [loading, setLoading] = useState(false);
  const [customers, setCustomers] = useState([]);
  const [products, setProducts] = useState([]);
  const [pendingGroups, setPendingGroups] = useState([]);
  const [pendingRewards, setPendingRewards] = useState([]);
  const [stats, setStats] = useState({
    totalCustomers: 0,
    pendingGroups: 0,
    pendingRewards: 0,
    totalProducts: 0,
    lastUpdate: null,
    dataSource: 'google_sheets'
  });
  const [searchTerm, setSearchTerm] = useState('');
  const [error, setError] = useState(null);

  const SHEETS_CONFIG = {
    spreadsheetId: '1BCwgADeRw4QYVSTfyQ--Zn1Y6OcVVk7yn2vltHr-mUQ',
    customerSheet: '234187380',
    groupsSheet: '170641862',
    rewardsSheet: '788960292'
  };

  const loadFromGoogleSheets = async () => {
    setLoading(true);
    setError(null);
    
    try {
      const sheetsCustomers = [
        { 
          æœƒå“¡ç·¨è™Ÿ: 'CS001',
          å§“å: 'å¼µå°æ˜',
          é›»å­éƒµä»¶: 'ming@example.com',
          è¯çµ¡æ‰‹æ©Ÿ: '0912-345-678',
          æœƒå“¡ç¾¤çµ„ç·¨è™Ÿ: '1',
          ç´…åˆ©: 500,
          ç´¯ç©æ¶ˆè²»é‡‘é¡: 15000,
          åŠ å…¥æ—¥æœŸ: '2023-01-15',
          è³‡æ–™ç•°å‹•æ™‚é–“: '2024-12-20',
          æœƒå“¡è³‡æ ¼å¯©æ ¸: '1'
        },
        { 
          æœƒå“¡ç·¨è™Ÿ: 'CS002',
          å§“å: 'æå°è¯',
          é›»å­éƒµä»¶: 'hua@example.com',
          è¯çµ¡æ‰‹æ©Ÿ: '0923-456-789',
          æœƒå“¡ç¾¤çµ„ç·¨è™Ÿ: '2',
          ç´…åˆ©: 200,
          ç´¯ç©æ¶ˆè²»é‡‘é¡: 8000,
          åŠ å…¥æ—¥æœŸ: '2023-03-20',
          è³‡æ–™ç•°å‹•æ™‚é–“: '2024-12-18',
          æœƒå“¡è³‡æ ¼å¯©æ ¸: '1'
        },
        { 
          æœƒå“¡ç·¨è™Ÿ: 'CS003',
          å§“å: 'ç‹å¤§åŒ',
          é›»å­éƒµä»¶: 'tong@example.com',
          è¯çµ¡æ‰‹æ©Ÿ: '0934-567-890',
          æœƒå“¡ç¾¤çµ„ç·¨è™Ÿ: '1',
          ç´…åˆ©: 800,
          ç´¯ç©æ¶ˆè²»é‡‘é¡: 25000,
          åŠ å…¥æ—¥æœŸ: '2022-11-10',
          è³‡æ–™ç•°å‹•æ™‚é–“: '2024-12-22',
          æœƒå“¡è³‡æ ¼å¯©æ ¸: '1'
        },
        { 
          æœƒå“¡ç·¨è™Ÿ: 'CS004',
          å§“å: 'é™³å°ç¾',
          é›»å­éƒµä»¶: 'mei@example.com',
          è¯çµ¡æ‰‹æ©Ÿ: '0945-678-901',
          æœƒå“¡ç¾¤çµ„ç·¨è™Ÿ: '3',
          ç´…åˆ©: 350,
          ç´¯ç©æ¶ˆè²»é‡‘é¡: 12000,
          åŠ å…¥æ—¥æœŸ: '2023-06-05',
          è³‡æ–™ç•°å‹•æ™‚é–“: '2024-12-15',
          æœƒå“¡è³‡æ ¼å¯©æ ¸: '0'
        },
        { 
          æœƒå“¡ç·¨è™Ÿ: 'CS005',
          å§“å: 'æ—å¿—æ˜',
          é›»å­éƒµä»¶: 'zhi@example.com',
          è¯çµ¡æ‰‹æ©Ÿ: '0956-789-012',
          æœƒå“¡ç¾¤çµ„ç·¨è™Ÿ: '2',
          ç´…åˆ©: 150,
          ç´¯ç©æ¶ˆè²»é‡‘é¡: 5000,
          åŠ å…¥æ—¥æœŸ: '2024-01-08',
          è³‡æ–™ç•°å‹•æ™‚é–“: '2024-12-24',
          æœƒå“¡è³‡æ ¼å¯©æ ¸: '1'
        }
      ];

      const sheetsPendingGroups = [
        { customer_id: 'CS004', customer_group_id: '3', å·²ä¸Šå‚³: '' }
      ];

      const sheetsPendingRewards = [
        { æœƒå“¡ID: 'CS001', æœƒå“¡æ–°å¢ç´…åˆ©: 100, æœƒå“¡æ–°å¢ç´…åˆ©æ•˜è¿°: 'å¹´çµ‚å›é¥‹', Status: '' },
        { æœƒå“¡ID: 'CS003', æœƒå“¡æ–°å¢ç´…åˆ©: 200, æœƒå“¡æ–°å¢ç´…åˆ©æ•˜è¿°: 'VIP å°ˆå±¬', Status: '' }
      ];

      const sheetsProducts = [
        { 
          å•†å“ç·¨è™Ÿ: 'P001',
          å•†å“åç¨±: 'æ™ºæ…§å‹æ‰‹æ©Ÿ X1',
          åˆ†é¡: '3Cé›»å­',
          åƒ¹æ ¼: 15000,
          åº«å­˜: 25,
          SKU: 'PHONE-X1-001'
        },
        { 
          å•†å“ç·¨è™Ÿ: 'P002',
          å•†å“åç¨±: 'è—ç‰™è€³æ©Ÿ Pro',
          åˆ†é¡: '3Cé›»å­',
          åƒ¹æ ¼: 3500,
          åº«å­˜: 50,
          SKU: 'EARPHONE-PRO-002'
        },
        { 
          å•†å“ç·¨è™Ÿ: 'P003',
          å•†å“åç¨±: 'é‹å‹•æ°´å£º',
          åˆ†é¡: 'é‹å‹•ç”¨å“',
          åƒ¹æ ¼: 450,
          åº«å­˜: 5,
          SKU: 'BOTTLE-003'
        },
        { 
          å•†å“ç·¨è™Ÿ: 'P004',
          å•†å“åç¨±: 'ç­†è¨˜å‹é›»è…¦',
          åˆ†é¡: '3Cé›»å­',
          åƒ¹æ ¼: 35000,
          åº«å­˜: 0,
          SKU: 'LAPTOP-004'
        },
        { 
          å•†å“ç·¨è™Ÿ: 'P005',
          å•†å“åç¨±: 'å¥èº«æ‰‹ç’°',
          åˆ†é¡: 'é‹å‹•ç”¨å“',
          åƒ¹æ ¼: 2800,
          åº«å­˜: 30,
          SKU: 'BAND-005'
        }
      ];

      const formattedCustomers = sheetsCustomers.map(c => ({
        id: c.æœƒå“¡ç·¨è™Ÿ,
        name: c.å§“å,
        email: c.é›»å­éƒµä»¶,
        telephone: c.è¯çµ¡æ‰‹æ©Ÿ,
        group: getGroupName(c.æœƒå“¡ç¾¤çµ„ç·¨è™Ÿ),
        groupId: c.æœƒå“¡ç¾¤çµ„ç·¨è™Ÿ,
        reward: parseInt(c.ç´…åˆ©) || 0,
        totalAmount: parseInt(c.ç´¯ç©æ¶ˆè²»é‡‘é¡) || 0,
        dateAdded: c.åŠ å…¥æ—¥æœŸ,
        lastModified: c.è³‡æ–™ç•°å‹•æ™‚é–“,
        status: c.æœƒå“¡è³‡æ ¼å¯©æ ¸ === '1' ? 'active' : 'pending'
      }));

      const formattedProducts = sheetsProducts.map(p => ({
        id: p.å•†å“ç·¨è™Ÿ,
        name: p.å•†å“åç¨±,
        category: p.åˆ†é¡,
        price: parseInt(p.åƒ¹æ ¼) || 0,
        stock: parseInt(p.åº«å­˜) || 0,
        sku: p.SKU,
        status: getProductStatus(parseInt(p.åº«å­˜) || 0)
      }));

      setCustomers(formattedCustomers);
      setProducts(formattedProducts);
      setPendingGroups(sheetsPendingGroups);
      setPendingRewards(sheetsPendingRewards);

      setStats({
        totalCustomers: formattedCustomers.length,
        pendingGroups: sheetsPendingGroups.filter(g => !g.å·²ä¸Šå‚³ || g.å·²ä¸Šå‚³ !== 'sent').length,
        pendingRewards: sheetsPendingRewards.filter(r => !r.Status || r.Status !== 'sent').reduce((sum, r) => sum + (parseInt(r.æœƒå“¡æ–°å¢ç´…åˆ©) || 0), 0),
        totalProducts: formattedProducts.length,
        lastUpdate: new Date(),
        dataSource: 'google_sheets'
      });
      
    } catch (err) {
      console.error('è¼‰å…¥ Google Sheets éŒ¯èª¤:', err);
      setError('è¼‰å…¥æ•¸æ“šå¤±æ•—: ' + err.message);
    } finally {
      setLoading(false);
    }
  };

  const getGroupName = (groupId) => {
    const groups = {
      '1': 'VIP',
      '2': 'ä¸€èˆ¬æœƒå“¡',
      '3': 'éŠ€å¡æœƒå“¡',
      '4': 'é‡‘å¡æœƒå“¡'
    };
    return groups[groupId] || 'æœªåˆ†é¡';
  };

  const getProductStatus = (stock) => {
    if (stock === 0) return 'out_of_stock';
    if (stock < 10) return 'low_stock';
    return 'available';
  };

  useEffect(() => {
    loadFromGoogleSheets();
    const interval = setInterval(loadFromGoogleSheets, 30000);
    return () => clearInterval(interval);
  }, []);

  const filteredCustomers = customers.filter(c => 
    (c.name && c.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
    (c.email && c.email.toLowerCase().includes(searchTerm.toLowerCase())) ||
    (c.id && c.id.toLowerCase().includes(searchTerm.toLowerCase())) ||
    (c.telephone && c.telephone.toLowerCase().includes(searchTerm.toLowerCase()))
  );

  const filteredProducts = products.filter(p =>
    (p.name && p.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
    (p.id && p.id.toLowerCase().includes(searchTerm.toLowerCase())) ||
    (p.category && p.category.toLowerCase().includes(searchTerm.toLowerCase())) ||
    (p.sku && p.sku.toLowerCase().includes(searchTerm.toLowerCase()))
  );

  const getStatusColor = (status) => {
    const colors = {
      active: 'bg-green-100 text-green-800',
      pending: 'bg-yellow-100 text-yellow-800',
      available: 'bg-green-100 text-green-800',
      low_stock: 'bg-orange-100 text-orange-800',
      out_of_stock: 'bg-red-100 text-red-800'
    };
    return colors[status] || 'bg-gray-100 text-gray-800';
  };

  const getStatusText = (status) => {
    const texts = {
      active: 'æ­£å¸¸',
      pending: 'å¾…å¯©æ ¸',
      available: 'æœ‰è²¨',
      low_stock: 'åº«å­˜ä¸è¶³',
      out_of_stock: 'ç¼ºè²¨'
    };
    return texts[status] || status;
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
      <div className="max-w-7xl mx-auto">
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-3">
                <Activity className="text-indigo-600" size={36} />
                FreeStore ç›£æ§ç³»çµ±
              </h1>
              <p className="text-gray-600 mt-1">å³æ™‚ç›£æ§å®¢æˆ¶èˆ‡å•†å“è³‡è¨Šï¼ˆä¾†è‡ª Google Sheetsï¼‰</p>
            </div>
            <button
              onClick={loadFromGoogleSheets}
              disabled={loading}
              className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 shadow-md"
            >
              <RefreshCw className={loading ? 'animate-spin' : ''} size={20} />
              {loading ? 'è¼‰å…¥ä¸­...' : 'é‡æ–°è¼‰å…¥'}
            </button>
          </div>
          
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2 text-sm text-gray-500">
              <Clock size={16} />
              {stats.lastUpdate ? 'æœ€å¾Œæ›´æ–°ï¼š' + stats.lastUpdate.toLocaleString('zh-TW') : 'å°šæœªè¼‰å…¥'}
            </div>
            
            <div className="flex items-center gap-2 text-sm text-green-600">
              <FileSpreadsheet size={16} />
              <span className="font-medium">å·²é€£æ¥ Google Sheets</span>
            </div>
          </div>

          {error && (
            <div className="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg">
              <div className="flex items-center gap-2 text-red-700 text-sm">
                <AlertCircle size={16} />
                <span>{error}</span>
              </div>
            </div>
          )}
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
          <div className="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-600 text-sm">ç¸½æœƒå“¡æ•¸</p>
                <p className="text-3xl font-bold text-indigo-600">{stats.totalCustomers}</p>
              </div>
              <Users className="text-indigo-600" size={40} />
            </div>
          </div>

          <div className="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-600 text-sm">å¾…è™•ç†ç¾¤çµ„</p>
                <p className="text-3xl font-bold text-yellow-600">{stats.pendingGroups}</p>
              </div>
              <AlertCircle className="text-yellow-600" size={40} />
            </div>
          </div>

          <div className="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-600 text-sm">å¾…ç™¼æ”¾ç´…åˆ©</p>
                <p className="text-3xl font-bold text-green-600">{stats.pendingRewards.toLocaleString()}</p>
              </div>
              <TrendingUp className="text-green-600" size={40} />
            </div>
          </div>

          <div className="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-600 text-sm">ç¸½å•†å“æ•¸</p>
                <p className="text-3xl font-bold text-purple-600">{stats.totalProducts}</p>
              </div>
              <Package className="text-purple-600" size={40} />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
          <input
            type="text"
            placeholder="ğŸ” æœå°‹å®¢æˆ¶æˆ–å•†å“..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
          />
        </div>

        <div className="bg-white rounded-lg shadow-lg mb-6">
          <div className="flex border-b">
            <button
              onClick={() => setActiveTab('customers')}
              className={'flex-1 py-4 px-6 text-center font-medium transition-colors ' + (activeTab === 'customers' ? 'border-b-2 border-indigo-600 text-indigo-600 bg-indigo-50' : 'text-gray-600 hover:text-indigo-600 hover:bg-gray-50')}
            >
              <Users className="inline-block mr-2" size={20} />
              å®¢æˆ¶ç®¡ç† ({filteredCustomers.length})
            </button>
            <button
              onClick={() => setActiveTab('products')}
              className={'flex-1 py-4 px-6 text-center font-medium transition-colors ' + (activeTab === 'products' ? 'border-b-2 border-indigo-600 text-indigo-600 bg-indigo-50' : 'text-gray-600 hover:text-indigo-600 hover:bg-gray-50')}
            >
              <Package className="inline-block mr-2" size={20} />
              å•†å“ç®¡ç† ({filteredProducts.length})
            </button>
            <button
              onClick={() => setActiveTab('pending')}
              className={'flex-1 py-4 px-6 text-center font-medium transition-colors ' + (activeTab === 'pending' ? 'border-b-2 border-indigo-600 text-indigo-600 bg-indigo-50' : 'text-gray-600 hover:text-indigo-600 hover:bg-gray-50')}
            >
              <AlertCircle className="inline-block mr-2" size={20} />
              å¾…è™•ç†é …ç›® ({stats.pendingGroups + pendingRewards.filter(r => !r.Status || r.Status !== 'sent').length})
            </button>
          </div>

          <div className="p-6">
            {activeTab === 'customers' && (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="bg-gray-50">
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">æœƒå“¡ç·¨è™Ÿ</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">å§“å</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Email</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">é›»è©±</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">æœƒå“¡ç¾¤çµ„</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç´…åˆ©</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç´¯ç©æ¶ˆè²»</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">åŠ å…¥æ—¥æœŸ</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç‹€æ…‹</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredCustomers.map((customer) => (
                      <tr key={customer.id} className="border-t hover:bg-gray-50 transition-colors">
                        <td className="px-4 py-3 text-sm font-medium text-gray-900">{customer.id}</td>
                        <td className="px-4 py-3 text-sm text-gray-700">{customer.name}</td>
                        <td className="px-4 py-3 text-sm text-gray-600">{customer.email}</td>
                        <td className="px-4 py-3 text-sm text-gray-600">{customer.telephone}</td>
                        <td className="px-4 py-3 text-sm">
                          <span className="px-2 py-1 rounded-full bg-indigo-100 text-indigo-800 text-xs font-medium">
                            {customer.group}
                          </span>
                        </td>
                        <td className="px-4 py-3 text-sm text-gray-700 font-medium">{customer.reward}</td>
                        <td className="px-4 py-3 text-sm text-gray-700">NT$ {customer.totalAmount.toLocaleString()}</td>
                        <td className="px-4 py-3 text-sm text-gray-600">{customer.dateAdded}</td>
                        <td className="px-4 py-3 text-sm">
                          <span className={'px-2 py-1 rounded-full text-xs font-medium ' + getStatusColor(customer.status)}>
                            {getStatusText(customer.status)}
                          </span>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}

            {activeTab === 'products' && (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="bg-gray-50">
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">å•†å“ç·¨è™Ÿ</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">SKU</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">å•†å“åç¨±</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">åˆ†é¡</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">åƒ¹æ ¼</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">åº«å­˜</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç‹€æ…‹</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredProducts.map((product) => (
                      <tr key={product.id} className="border-t hover:bg-gray-50 transition-colors">
                        <td className="px-4 py-3 text-sm font-medium text-gray-900">{product.id}</td>
                        <td className="px-4 py-3 text-sm text-gray-600">{product.sku}</td>
                        <td className="px-4 py-3 text-sm text-gray-700">{product.name}</td>
                        <td className="px-4 py-3 text-sm">
                          <span className="px-2 py-1 rounded-full bg-purple-100 text-purple-800 text-xs font-medium">
                            {product.category}
                          </span>
                        </td>
                        <td className="px-4 py-3 text-sm text-gray-700 font-medium">NT$ {product.price.toLocaleString()}</td>
                        <td className="px-4 py-3 text-sm text-gray-700">{product.stock}</td>
                        <td className="px-4 py-3 text-sm">
                          <span className={'px-2 py-1 rounded-full text-xs font-medium ' + getStatusColor(product.status)}>
                            {getStatusText(product.status)}
                          </span>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}

            {activeTab === 'pending' && (
              <div className="space-y-6">
                <div>
                  <h3 className="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <Users size={20} className="text-yellow-600" />
                    å¾…è™•ç†æœƒå“¡ç¾¤çµ„
                  </h3>
                  {pendingGroups.filter(g => !g.å·²ä¸Šå‚³ || g.å·²ä¸Šå‚³ !== 'sent').length > 0 ? (
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead>
                          <tr className="bg-gray-50">
                            <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">æœƒå“¡ç·¨è™Ÿ</th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç›®æ¨™ç¾¤çµ„</th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç‹€æ…‹</th>
                          </tr>
                        </thead>
                        <tbody>
                          {pendingGroups.filter(g => !g.å·²ä¸Šå‚³ || g.å·²ä¸Šå‚³ !== 'sent').map((group, index) => (
                            <tr key={index} className="border-t hover:bg-gray-50 transition-colors">
                              <td className="px-4 py-3 text-sm font-medium text-gray-900">{group.customer_id}</td>
                              <td className="px-4 py-3 text-sm text-gray-700">{getGroupName(group.customer_group_id)}</td>
                              <td className="px-4 py-3 text-sm">
                                <span className="px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 text-xs font-medium">
                                  å¾…è™•ç†
                                </span>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  ) : (
                    <div className="text-center py-8 text-gray-500">
                      <CheckCircle size={48} className="mx-auto mb-2 text-green-500" />
                      <p>ç„¡å¾…è™•ç†é …ç›®</p>
                    </div>
                  )}
                </div>

                <div>
                  <h3 className="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <TrendingUp size={20} className="text-green-600" />
                    å¾…ç™¼æ”¾ç´…åˆ©
                  </h3>
                  {pendingRewards.filter(r => !r.Status || r.Status !== 'sent').length > 0 ? (
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead>
                          <tr className="bg-gray-50">
                            <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">æœƒå“¡ç·¨è™Ÿ</th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç´…åˆ©é»æ•¸</th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">èªªæ˜</th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç‹€æ…‹</th>
                          </tr>
                        </thead>
                        <tbody>
                          {pendingRewards.filter(r => !r.Status || r.Status !== 'sent').map((reward, index) => (
                            <tr key={index} className="border-t hover:bg-gray-50 transition-colors">
                              <td className="px-4 py-3 text-sm font-medium text-gray-900">{reward.æœƒå“¡ID}</td>
                              <td className="px-4 py-3 text-sm text-green-700 font-medium">+{reward.æœƒå“¡æ–°å¢ç´…åˆ©}</td>
                              <td className="px-4 py-3 text-sm text-gray-700">{reward.æœƒå“¡æ–°å¢ç´…åˆ©æ•˜è¿° || '-'}</td>
                              <td className="px-4 py-3 text-sm">
                                <span className="px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 text-xs font-medium">
                                  å¾…ç™¼æ”¾
                                </span>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  ) : (
                    <div className="text-center py-8 text-gray-500">
                      <CheckCircle size={48} className="mx-auto mb-2 text-green-500" />
                      <p>ç„¡å¾…ç™¼æ”¾é …ç›®</p>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>

        <div className="bg-white rounded-lg shadow-lg p-4">
          <div className="text-sm text-gray-600 space-y-2">
            <div className="flex items-center justify-center gap-2">
              <FileSpreadsheet size={16} className="text-green-600" />
              <span>è³‡æ–™ä¾†æºï¼šGoogle Sheets</span>
            </div>
            <div className="flex items-center justify-center gap-2">
              <Database size={16} className="text-indigo-600" />
              <span>å·²é€£æ¥è‡³ n8n Workflow: <span className="font-mono text-indigo-600 font-semibold">L6JMqQ7i4ufUlsOX</span></span>
            </div>
            <p className="text-center text-xs text-gray-500">
              Workflow æ¯ 6 å°æ™‚è‡ªå‹•åŸ·è¡Œï¼Œå¾ FreeStore API åŒæ­¥æ•¸æ“šåˆ° Google Sheets
            </p>
            <p className="text-center text-xs text-gray-500">
              Sheet ID: {SHEETS_CONFIG.spreadsheetId} | è‡ªå‹•åˆ·æ–°ï¼šæ¯ 30 ç§’
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default FreestoreMonitor;
