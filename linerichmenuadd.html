<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE Rich Menu è¨­å®šå·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .size-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .size-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .size-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        .size-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        .preview-container {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
        }
        .preview-image {
            max-width: 100%;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-top: 15px;
        }
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .template-item {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        .template-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .template-item.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .action-buttons {
            text-align: center;
            margin-top: 30px;
        }
        .json-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ LINE Rich Menu è¨­å®šå·¥å…·</h1>
        
        <div class="info-box">
            <strong>èªªæ˜ï¼š</strong>é¸æ“‡é¸å–®å°ºå¯¸ã€è¨­å®šåŸºæœ¬è³‡è¨Šã€é¸æ“‡ç¯„æœ¬æˆ–ä¸Šå‚³åœ–ç‰‡ï¼Œé è¦½å¾Œå³å¯é€é n8n ä¸Šå‚³åˆ° LINE
        </div>

        <div class="form-group">
            <label>é¸å–®å°ºå¯¸</label>
            <div class="size-selector">
                <div class="size-btn active" onclick="selectSize('large')">
                    <div style="font-weight: 600; margin-bottom: 5px;">å¤§å‹é¸å–®</div>
                    <div style="font-size: 12px; color: #666;">2500 x 1686 px</div>
                </div>
                <div class="size-btn" onclick="selectSize('small')">
                    <div style="font-weight: 600; margin-bottom: 5px;">å°å‹é¸å–®</div>
                    <div style="font-size: 12px; color: #666;">2500 x 843 px</div>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label>é¸å–®åç¨±</label>
            <input type="text" id="menuName" placeholder="ä¾‹å¦‚ï¼šä¸»é¸å–®" value="åœ–æ–‡é¸å–®">
        </div>

        <div class="form-group">
            <label>èŠå¤©åˆ—é¡¯ç¤ºæ–‡å­—</label>
            <input type="text" id="chatBarText" placeholder="ä¾‹å¦‚ï¼šæŸ¥çœ‹æ›´å¤š" value="é»æ“ŠæŸ¥çœ‹é¸å–®">
        </div>

        <div class="form-group">
            <label>é¸æ“‡ç¯„æœ¬æˆ–ä¸Šå‚³åœ–ç‰‡</label>
            <div class="template-grid">
                <div class="template-item selected" onclick="selectTemplate('template1')">
                    <strong>ç¯„æœ¬ 1</strong><br>
                    <small>6æ ¼æ¨™æº–ç‰ˆ</small>
                </div>
                <div class="template-item" onclick="selectTemplate('template2')">
                    <strong>ç¯„æœ¬ 2</strong><br>
                    <small>4æ ¼å¤§æŒ‰éˆ•</small>
                </div>
                <div class="template-item" onclick="selectTemplate('custom')">
                    <strong>è‡ªè¨‚åœ–ç‰‡</strong><br>
                    <small>ä¸Šå‚³æª”æ¡ˆ</small>
                </div>
            </div>
            <input type="file" id="customImage" accept="image/png,image/jpeg,image/jpg" style="margin-top: 15px; display: none;" onchange="handleImageUpload(event)">
        </div>

        <div class="preview-container">
            <h3>é è¦½</h3>
            <div id="preview">
                <img class="preview-image" id="previewImage" src="" alt="è«‹é¸æ“‡ç¯„æœ¬æˆ–ä¸Šå‚³åœ–ç‰‡">
            </div>
            <div style="margin-top: 15px; color: #666;">
                <small>ç•¶å‰å°ºå¯¸: <span id="currentSize">2500 x 1686 px (å¤§å‹)</span></small>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="generateJSON()">ç”¢ç”Ÿ JSON è¨­å®š</button>
            <button class="btn btn-primary" onclick="sendToN8N()">ä¸Šå‚³åˆ° LINE</button>
            <button class="btn btn-secondary" onclick="copyJSON()">è¤‡è£½ JSON</button>
        </div>

        <div class="form-group">
            <label>JSON è¨­å®šæª”</label>
            <div class="json-output" id="jsonOutput">ç­‰å¾…ç”¢ç”Ÿ...</div>
        </div>
    </div>

    <script>
        let currentSize = 'large';
        let currentTemplate = 'template1';
        let customImageData = null;
        let n8nWebhookURL = 'https://n8n.criterium.tw/webhook/line-richmenu-upload';

        const templates = {
            large: {
                template1: {
                    areas: [
                        { bounds: { x: 0, y: 0, width: 833, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•1' } },
                        { bounds: { x: 833, y: 0, width: 834, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•2' } },
                        { bounds: { x: 1667, y: 0, width: 833, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•3' } },
                        { bounds: { x: 0, y: 843, width: 833, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•4' } },
                        { bounds: { x: 833, y: 843, width: 834, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•5' } },
                        { bounds: { x: 1667, y: 843, width: 833, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•6' } }
                    ]
                },
                template2: {
                    areas: [
                        { bounds: { x: 0, y: 0, width: 1250, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•1' } },
                        { bounds: { x: 1250, y: 0, width: 1250, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•2' } },
                        { bounds: { x: 0, y: 843, width: 1250, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•3' } },
                        { bounds: { x: 1250, y: 843, width: 1250, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•4' } }
                    ]
                }
            },
            small: {
                template1: {
                    areas: [
                        { bounds: { x: 0, y: 0, width: 833, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•1' } },
                        { bounds: { x: 833, y: 0, width: 834, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•2' } },
                        { bounds: { x: 1667, y: 0, width: 833, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•3' } }
                    ]
                },
                template2: {
                    areas: [
                        { bounds: { x: 0, y: 0, width: 1250, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•1' } },
                        { bounds: { x: 1250, y: 0, width: 1250, height: 843 }, action: { type: 'message', text: 'æŒ‰éˆ•2' } }
                    ]
                }
            }
        };

        function selectSize(size) {
            currentSize = size;
            document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.size-btn').classList.add('active');
            
            const sizeText = size === 'large' ? '2500 x 1686 px (å¤§å‹)' : '2500 x 843 px (å°å‹)';
            document.getElementById('currentSize').textContent = sizeText;
            
            generateJSON();
        }

        function selectTemplate(template) {
            currentTemplate = template;
            document.querySelectorAll('.template-item').forEach(item => item.classList.remove('selected'));
            event.target.closest('.template-item').classList.add('selected');
            
            if (template === 'custom') {
                document.getElementById('customImage').click();
            } else {
                customImageData = null;
                updatePreview();
            }
            
            generateJSON();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    customImageData = e.target.result;
                    document.getElementById('previewImage').src = customImageData;
                };
                reader.readAsDataURL(file);
            }
        }

        function updatePreview() {
            const img = document.getElementById('previewImage');
            if (currentTemplate !== 'custom') {
                img.src = `data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='2500' height='${currentSize === 'large' ? '1686' : '843'}'><rect width='2500' height='${currentSize === 'large' ? '1686' : '843'}' fill='%23f0f0f0'/><text x='50%' y='50%' font-family='Arial' font-size='48' fill='%23666' text-anchor='middle' dominant-baseline='middle'>ç¯„æœ¬ ${currentTemplate.slice(-1)} (${currentSize === 'large' ? 'å¤§å‹' : 'å°å‹'})</text></svg>`;
            }
        }

        function generateJSON() {
            const menuName = document.getElementById('menuName').value || 'åœ–æ–‡é¸å–®';
            const chatBarText = document.getElementById('chatBarText').value || 'é»æ“ŠæŸ¥çœ‹é¸å–®';
            
            const richMenuConfig = {
                size: {
                    width: 2500,
                    height: currentSize === 'large' ? 1686 : 843
                },
                selected: true,
                name: menuName,
                chatBarText: chatBarText,
                areas: currentTemplate !== 'custom' ? templates[currentSize][currentTemplate].areas : []
            };

            document.getElementById('jsonOutput').textContent = JSON.stringify(richMenuConfig, null, 2);
            updatePreview();
        }

        function copyJSON() {
            const jsonText = document.getElementById('jsonOutput').textContent;
            navigator.clipboard.writeText(jsonText).then(() => {
                alert('JSON å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            });
        }

        async function sendToN8N() {
            const jsonConfig = document.getElementById('jsonOutput').textContent;
            const imageFile = document.getElementById('customImage').files[0];
            
            const formData = new FormData();
            formData.append('richMenuConfig', jsonConfig);
            
            if (imageFile) {
                formData.append('image', imageFile);
            }
            
            try {
                const response = await fetch(n8nWebhookURL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert('ä¸Šå‚³æˆåŠŸï¼Rich Menu ID: ' + result.richMenuId);
                } else {
                    alert('ä¸Šå‚³å¤±æ•—ï¼š' + result.error);
                }
            } catch (error) {
                alert('ä¸Šå‚³éŒ¯èª¤ï¼š' + error.message);
            }
        }

        // åˆå§‹åŒ–
        generateJSON();
    </script>
</body>
</html>
