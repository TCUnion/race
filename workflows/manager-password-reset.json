{
    "name": "TCU-å¯†ç¢¼é‡è¨­-Webhook",
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "manager-password-reset",
                "responseMode": "responseNode",
                "options": {}
            },
            "id": "webhook-trigger",
            "name": "æ¥æ”¶å¯†ç¢¼é‡è¨­è«‹æ±‚",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
                240,
                300
            ],
            "webhookId": "manager-password-reset"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": false,
                        "leftValue": "",
                        "typeValidation": "loose"
                    },
                    "conditions": [
                        {
                            "id": "email-check",
                            "leftValue": "={{ $input.first().json.body.email }}",
                            "rightValue": "@",
                            "operator": {
                                "type": "string",
                                "operation": "contains"
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "id": "validate-input",
            "name": "é©—è­‰è¼¸å…¥",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                460,
                300
            ]
        },
        {
            "parameters": {
                "operation": "upsert",
                "schema": {
                    "__rl": true,
                    "value": "public",
                    "mode": "list",
                    "cachedResultName": "public"
                },
                "table": {
                    "__rl": true,
                    "value": "password_reset_tokens",
                    "mode": "list",
                    "cachedResultName": "password_reset_tokens"
                },
                "columns": {
                    "mappingMode": "defineBelow",
                    "value": {
                        "email": "={{ $json.body.email }}",
                        "token": "={{ $json.body.reset_token }}",
                        "expires_at": "={{ $json.body.expires_at }}",
                        "used_at": null,
                        "created_at": "={{ $now.toISO() }}"
                    }
                },
                "conflictColumns": [
                    "email"
                ],
                "options": {}
            },
            "id": "save-token",
            "name": "å„²å­˜é‡è¨­ Token",
            "type": "n8n-nodes-base.postgres",
            "typeVersion": 2.5,
            "position": [
                680,
                220
            ],
            "credentials": {
                "postgres": {
                    "id": "YOUR_POSTGRES_CREDENTIAL_ID",
                    "name": "Supabase PostgreSQL"
                }
            }
        },
        {
            "parameters": {
                "sendTo": "={{ $('æ¥æ”¶å¯†ç¢¼é‡è¨­è«‹æ±‚').item.json.body.email }}",
                "subject": "ã€TCUã€‘å¯†ç¢¼é‡è¨­è«‹æ±‚",
                "emailType": "html",
                "message": "=<div style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 600px; margin: 0 auto; padding: 40px 20px; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);\">\n  <div style=\"background: rgba(30, 41, 59, 0.8); border-radius: 16px; padding: 40px; border: 1px solid rgba(71, 85, 105, 0.3);\">\n    <div style=\"text-align: center; margin-bottom: 32px;\">\n      <h1 style=\"color: #f8fafc; font-size: 24px; font-weight: 700; margin: 0;\">ğŸ” å¯†ç¢¼é‡è¨­è«‹æ±‚</h1>\n    </div>\n    \n    <p style=\"color: #cbd5e1; font-size: 16px; line-height: 1.6; margin-bottom: 24px;\">\n      æ‚¨å¥½ï¼Œ<strong style=\"color: #60a5fa;\">{{ $('æ¥æ”¶å¯†ç¢¼é‡è¨­è«‹æ±‚').item.json.body.shop_name }}</strong>ï¼\n    </p>\n    \n    <p style=\"color: #94a3b8; font-size: 14px; line-height: 1.6; margin-bottom: 32px;\">\n      æˆ‘å€‘æ”¶åˆ°äº†æ‚¨çš„å¯†ç¢¼é‡è¨­è«‹æ±‚ã€‚è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•è¨­å®šæ–°å¯†ç¢¼ï¼š\n    </p>\n    \n    <div style=\"text-align: center; margin-bottom: 32px;\">\n      <a href=\"{{ $('æ¥æ”¶å¯†ç¢¼é‡è¨­è«‹æ±‚').item.json.body.reset_url }}\" \n         style=\"display: inline-block; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; text-decoration: none; padding: 16px 48px; border-radius: 12px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4);\">\n        é‡è¨­å¯†ç¢¼\n      </a>\n    </div>\n    \n    <p style=\"color: #64748b; font-size: 12px; line-height: 1.6; margin-bottom: 16px;\">\n      â° æ­¤é€£çµå°‡æ–¼ <strong>1 å°æ™‚å¾Œ</strong> å¤±æ•ˆã€‚\n    </p>\n    \n    <p style=\"color: #64748b; font-size: 12px; line-height: 1.6;\">\n      å¦‚æœæ‚¨æ²’æœ‰è«‹æ±‚é‡è¨­å¯†ç¢¼ï¼Œè«‹å¿½ç•¥æ­¤éƒµä»¶ï¼Œæ‚¨çš„å¸³è™Ÿä»ç„¶å®‰å…¨ã€‚\n    </p>\n    \n    <hr style=\"border: none; border-top: 1px solid rgba(71, 85, 105, 0.3); margin: 32px 0;\" />\n    \n    <p style=\"color: #475569; font-size: 11px; text-align: center;\">\n      å¦‚æœæŒ‰éˆ•ç„¡æ³•é»æ“Šï¼Œè«‹è¤‡è£½ä»¥ä¸‹é€£çµåˆ°ç€è¦½å™¨ï¼š<br/>\n      <span style=\"color: #60a5fa; word-break: break-all;\">{{ $('æ¥æ”¶å¯†ç¢¼é‡è¨­è«‹æ±‚').item.json.body.reset_url }}</span>\n    </p>\n  </div>\n  \n  <p style=\"color: #475569; font-size: 11px; text-align: center; margin-top: 24px;\">\n    Â© Taiwan Cycling Union | æ­¤éƒµä»¶ç”±ç³»çµ±è‡ªå‹•ç™¼é€\n  </p>\n</div>",
                "options": {}
            },
            "id": "send-email",
            "name": "ç™¼é€é‡è¨­éƒµä»¶",
            "type": "n8n-nodes-base.emailSend",
            "typeVersion": 2.1,
            "position": [
                900,
                220
            ],
            "credentials": {
                "smtp": {
                    "id": "YOUR_SMTP_CREDENTIAL_ID",
                    "name": "TCU SMTP"
                }
            }
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ JSON.stringify({ success: true, message: 'é‡è¨­éƒµä»¶å·²ç™¼é€' }) }}",
                "options": {}
            },
            "id": "success-response",
            "name": "å›å‚³æˆåŠŸ",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.1,
            "position": [
                1120,
                220
            ]
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ JSON.stringify({ success: false, message: 'è«‹æä¾›æœ‰æ•ˆçš„ Email' }) }}",
                "options": {
                    "responseCode": 400
                }
            },
            "id": "error-response",
            "name": "å›å‚³éŒ¯èª¤",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.1,
            "position": [
                680,
                420
            ]
        }
    ],
    "connections": {
        "æ¥æ”¶å¯†ç¢¼é‡è¨­è«‹æ±‚": {
            "main": [
                [
                    {
                        "node": "é©—è­‰è¼¸å…¥",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "é©—è­‰è¼¸å…¥": {
            "main": [
                [
                    {
                        "node": "å„²å­˜é‡è¨­ Token",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "å›å‚³éŒ¯èª¤",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "å„²å­˜é‡è¨­ Token": {
            "main": [
                [
                    {
                        "node": "ç™¼é€é‡è¨­éƒµä»¶",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "ç™¼é€é‡è¨­éƒµä»¶": {
            "main": [
                [
                    {
                        "node": "å›å‚³æˆåŠŸ",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
        {
            "name": "TCU",
            "createdAt": "2026-01-31T00:00:00.000Z",
            "updatedAt": "2026-01-31T00:00:00.000Z"
        },
        {
            "name": "å¯†ç¢¼é‡è¨­",
            "createdAt": "2026-01-31T00:00:00.000Z",
            "updatedAt": "2026-01-31T00:00:00.000Z"
        }
    ],
    "triggerCount": 0,
    "updatedAt": "2026-01-31T00:00:00.000Z",
    "versionId": "1"
}